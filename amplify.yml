version: 1
frontend:
  phases:
    preBuild:
      commands:
        - 'nvm use 22'
        - 'npm i -g bun'
        - 'bun i'
        # Branch-specific .env injection
        - 'echo "Building for branch -> $AWS_BRANCH"'
        - |
          if [ "$AWS_BRANCH" = "production" ]; then
            cp .env.production .env
          elif [ "$AWS_BRANCH" = "main" ]; then
            cp .env.staging .env
          else
            echo "No specific env file for branch $AWS_BRANCH. Using default .env if present."
          fi
    build:
      commands:
        - 'echo "Active env file (first lines, if present):"'
        - 'head -n 5 .env || echo ".env not found"'
        - 'bun run build'
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
